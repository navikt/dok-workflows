name: Determine Java version

on:
  workflow_call:
    outputs:
      java-version:
        description: "Determined Java version"
        value: ${{ jobs.determine-java-version.outputs.java-version }}

jobs:
  determine-java-version:
    name: Determine Java version
    runs-on: ubuntu-latest
    outputs:
      java-version: ${{ steps.extract-java-version.outputs.java-version }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v5

      - name: Extract Java version from pom.xml
        id: extract-java-version
        run: |
          #Hent java versjon fra pom.xml. Ser etter første property på formatet <java.version>...</java.version>
          JAVA_VERSION=$(sed -n 's/.*<java\.version>\([^<]*\)<\/java\.version>.*/\1/p' pom.xml | head -1)
          
          if [ -z "$JAVA_VERSION" ]; then
            JAVA_VERSION="21"
            echo "Fant ikke java versjon i pom.xml, defaulter til: $JAVA_VERSION"
          else
            #Hent major versjon (dvs "21" fra "21.0.8")
            JAVA_VERSION=$(echo "$JAVA_VERSION" | cut -d'.' -f1)
            echo "Fant java versjon $JAVA_VERSION i pom.xml"
          fi
          echo "java-version=$JAVA_VERSION" >> $GITHUB_OUTPUT
